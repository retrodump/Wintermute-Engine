<html>

<head>
<meta http-equiv="Content-Language" content="cs">
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
<title>Krok 7: Regionové entity, kurzory, skripty</title>
<link rel="stylesheet" type="text/css" href="../styles.css">
</head>

<body>

<h3>Krok 7: Regionové entity, kurzory, skripty</h3>

<h4>&nbsp;</h4>

<h4><a name="region_entities"></a>Regionové entity</h4>
<p>Pokud otestujete naši scénu, zjistíte, e stùl a idle se jeví jako 
&quot;interaktivní&quot; objekty. Pokud nad nì posunete ukazatel myši, zmìní se kurzor a 
zobrazí se jejich název. To proto, jeliko entity tvoøící stùl a idli mají 
vlastnost &quot;Interactive&quot; (Interaktivní) nastavenu na true (pravda). Ale co 
kdybychom chtìli jako interaktivní nastavit èást pozadí scény? Je nutné vytváøet 
entity pro kadı z pøedmìtù, kterı má bıt interaktivní? Odpovìï je ano i ne. 
SceneEdit vám umoòuje vytvoøit takzvané &quot;regionové entity&quot;. Chovají se pøesnì 
jako normální entity, ale nepotøebují ádnou grafickou reprezentaci (tj. 
nemusíte pro nì malovat ádnı obrázek). Místo toho jen pøedstavují urèitou 
oblast ve scénì.</p>

<p>Uèiníme pár dalších objektù interaktivními, jmenovitì to budou dveøe, skøíò a 
okno.</p>

<p>Otevøete soubor &quot;MyScene.scene&quot; ve SceneEditu.</p>

<p>Abyste pøidali regionovou entitu, kliknìte na tlaèítko &quot;Add entity&quot; (Pøidat 
entitu) a v menu vyberte poloku &quot;Add region entity&quot; (Pøidat regionovou entitu).</p>

<p align="center">
<img border="0" src="../img/tut7-1.gif" width="213" height="169"></p>

<p align="center">&nbsp;</p>

<p>Bude vytvoøena nová entita. A teï u je to jednoduché. Mùete mìnit jméno a 
titulek v oknì vlastností a dále mùete upravovat tvar regionové entity úplnì 
stejnì jako pøi editaci regionù normálních.</p>

<p>Pøidejte do scény tøi regionové entity: &quot;door&quot; (dveøe), &quot;closet&quot; (skøíò) a &quot;window&quot; 
(okno):</p>



<p align="center">
<img border="0" src="../img/tut7-2.gif" width="164" height="335">&nbsp;&nbsp;&nbsp;
<img border="0" src="../img/tut7-3.gif" width="275" height="386">&nbsp;&nbsp;&nbsp;
<img border="0" src="../img/tut7-4.gif" width="211" height="236"></p>




<p align="center">
&nbsp;</p>




<p>Je dùleité si opìt uvìdomit, e poøadí entit a regionù je dùleité! U jsme 
si øekli, proè je dùleité pro rozvrení scény, ale poøadí je také dùleité s 
ohledem na uivatelskou interakci. Kdy herní engine zjišuje, nad jakım 
objektem je zrovna ukazatel myši, projídí postupnì všechny prvky scény odshora 
dolù.</p>
<p>V naší pokusné scénì sice na poøadí zase a tak nezáleí, protoe se navzájem 
nepøekrıvají, ale mìli byste na tohle vdy pamatovat.</p>


<p align="center">
<img border="0" src="../img/tut7-5.gif" width="185" height="212"></p>


<p align="center">&nbsp;</p>


<p>Pokud spustíte hru a vyzkoušíte scénu, dveøe, skøíò a okno u by se mìly stát 
interaktivními.</p>


<p>&nbsp;</p>


<h4><a name="cursors"></a>Kurzory</h4>
<p>Urèitì jste si všimli, e pokud najedete myší na nìkterı interaktivní objekt, 
zmìní se kurzor. Hra má dva pøeddefinované kurzory - standardní a aktivní <br>
(lze je zmìnit ve vlastnostech hry v programu ProjectMan). Ale také mùete 
nìkterım objektùm pøiøadit speciální kurzor. Øeknìme, e chceme, aby kurzor 
zmìnil tvar, pokud najedeme myší na dveøe. Je to velice jednoduché. Všechny 
kurzory jsou vlastnì sprity a mùete je pøiøadit entitám pøímo ve SceneEditu.</p>
<p>Pøepnìte se do SceneEditu a vyberte entitu &quot;door&quot; (dveøe).</p>

<table border="1" cellspacing="0" cellpadding="3" style="border-collapse: collapse" bordercolor="#111111">
<tr>
  <td>
    <p align="center"><img src="../img/hint.gif" width="23" height="30"><br><b>
    Rada</b>
  </td>
  <td>
    Chcete-li ve SceneEditu rychle vybrat nìjakı pøedmìt, double-clicknìte na 
    nìj pøímo v náhledu scény.
  </td>
</table>

<p>Podívejte se na okno vlastností entity a naleznete poloku &quot;Cursor&quot;. Kliknìte 
na tlaèítku &quot;...&quot; vedle vlastnosti &quot;Cursor&quot; a SceneEdit vás nechá vybrat sprite, 
kterı bude ve høe pouit jako kurzor pro tento objekt. V tomto vıukovém projektu 
u je nìkolik kurzorù pøipraveno v adresáøi &quot;data\sprite\system&quot;. Nalistujte 
tento adresáø,&nbsp; v nìm vyberte soubor &quot;arrow_left.sprite&quot; a kliknìte OK. 
Vlastnost &quot;Cursor&quot; se zmìní a nyní se odkazuje na vybranı soubor.</p>

<p>&nbsp;</p>

<table border="1" cellspacing="0" cellpadding="3" style="border-collapse: collapse" bordercolor="#111111">
<tr>
  <td>
    <p align="center"><img src="../img/hint.gif" width="23" height="30"><br><b>
    Rada</b>
  </td>
  <td>
    Pokud potøebujete odstranit vybranı kurzor, prostì opìt kliknìte na tlaèítko 
    &quot;...&quot; a a se zobrazí okno pro vıbìr souboru, stisknìte tlaèítko &quot;Storno&quot;. 
    SceneEdit se vás zeptá, zda máte v úmyslu odstranit aktuálnì vybranı soubor.
  </td>
</table>


<p>Ulote scénu a spuste hru. Pokud teï najedete myší nad dveøe, kurzor se 
zmìní na oranovou šipku.</p>


<p align="center">
<img border="0" src="../img/tut7-6.gif" width="184" height="216"></p>


<p align="center">&nbsp;</p>


<h4><a name="scripts"></a>Skripty</h4>
<p>Objekty ve scénì se nyní jeví jako interaktivní, ale kdy se na nì klikne, 
nic se nestane. Potøebujeme jim pøiøadit nìjakou logiku, a herní logika je 
reprezentována skripty. Skripty jsou textové soubory, obsahující jednoduchı 
program. Podrobnì jsou skripty popsány v <a href="scripting_about.html">jiné 
kapitole</a> této dokumentace, zde probereme pouze základy.</p>

<p>Pøipojíme skript k entitì &quot;desk&quot;, pøedstavující stùl. Nejjednodušší je pouít 
schopnost nástroje ProjectMan vytváøet nové soubory ze šablony. Tuto funkci u 
jsme nìkolikrát pouili a úplnì stejnì funguje i pro skripty. Pøepnìte se do 
ProjectManu, najdìte adresáø &quot;MyScene&quot; a rozkliknìte jeho vìtev pomocí malého 
(+). Adresáø &quot;MyScene&quot; by mìl mít podadresáø, nazvanı &quot;scr&quot;. Zde jsou uloeny 
skripty pro scénu. Kliknìte pravım tlaèítkem myši na adresáøi &quot;scr&quot; a v menu 
vyberte pøíkaz &quot;Add script&quot; (Pøidat skript).</p>

<p align="center">
<img border="0" src="../img/tut7-7.gif" width="258" height="249"></p>

<p align="center">&nbsp;</p>

<p>Objeví se okno pro vıbìr šablony. Zde vyberte vlevo &quot;scene object&quot;, vpravo 
zmìòte jméno na &quot;desk&quot; (stùl) a kliknìte na OK. V adresáøi &quot;scr&quot; bude vytvoøen 
novı skript s názvem &quot;desk&quot;.</p>

<p align="center">
<img border="0" src="../img/tut7-8.gif" width="563" height="412"></p>

<p align="center">&nbsp;</p>

<p>Otevøete soubor &quot;MyScene.scene&quot; ve SceneEditu. Chceme modifikovat entitu &quot;desk&quot;, 
take ji vyberte. Mùete buïto vybrat poloku &quot;desk&quot; vlevo v seznamu prvkù, nebo 
double-clicknout stùl v náhledu vpravo. Podívejme se na okno vlastností, je zde 
tlaèítko &quot;Scripts...&quot; (Skripty). Zmáèknìte jej a objeví se okno pro pøipojení 
skriptù. V tomto oknì mùete k objektu pøipojit jeden nebo více skriptù. 
Stisknìte tlaèítko &quot;Add script&quot; (Pøidat skript). V novìjších verzích WME se toto 
tlaèítko jmenuje &quot;Attach existing script&quot; (Pøipojit existující skript).</p>

<p align="center">
<img border="0" src="../img/tut7-9.gif" width="224" height="209">&nbsp;&nbsp;&nbsp;
<img border="0" src="../img/tut7-10.gif" width="330" height="262"></p>

<p align="center">&nbsp;</p>

<p>SceneEdit vás nechá vybrat soubor se skriptem, kterı chcete pøipojit. Najdìte 
a vyberte náš &quot;desk.script&quot; a kliknìte OK.</p>

<p align="center">
<img border="0" src="../img/tut7-11.gif" width="330" height="122"></p>

<p align="center">&nbsp;</p>

<p>Nyní budeme skript opravovat. Mùete jej otevøít v editoru buïto stisknutím 
tlaèítka &quot;Edit script&quot; (Opravit skript) nebo double-clickem na jménu skriptu. 
SceneEdit otevøe skript v pøiøazeném textovém editoru (vıchozí nastavení je 
program &quot;Poznámkovı blok&quot; ze systému Windows, pøeètìte si více o
<a href="scripting_editor.html">nastavení textového editoru</a> pro editaci 
skriptù).</p>

<table border="1" cellspacing="0" cellpadding="3" style="border-collapse: collapse" bordercolor="#111111">
<tr>
  <td>
    <p align="center"><img src="../img/hint.gif" width="23" height="30"><br><b>
    Rada</b>
  </td>
  <td>
    Pokud objekt doposud nemìl pøipojen ádnı skript, SceneEdit ihned po 
    kliknutí na tlaèítko &quot;Scripts...&quot; zobrazí okno pro vytvoøení nového skriptu. 
    Není tøeba jej vytváøet prostøednictvím ProjectManu, jak je popsáno vıše.</td>
</table>

<p>&nbsp;</p>

<p>Novı skript by mìl vypadat nìjak takhle:</p>

<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber1">
  <tr>
    <td class="code">
<pre>#include "scripts\base.inc"
 
////////////////////////////////////////////////////////////////////////////////
on "LookAt"
{
  GoToObject();
  actor.Talk("Blah");
}
 
////////////////////////////////////////////////////////////////////////////////
on "Take"
{
  GoToObject();
  actor.Talk("Blah");
}
 
.
.
.
 
////////////////////////////////////////////////////////////////////////////////
function GoToObject()
{
  actor.GoTo(200, 200);
  actor.TurnTo(DI_UP);
}</pre>
</table>



<p>Bloky &quot;<i>on &quot;xxx&quot; {}</i>&quot; jsou takzvané &quot;obsluhy událostí&quot; (event handlers). 
Tyto bloky jsou provedeny tehdy, pokud je v objektu vyvolána nìjaká událost. 
Napøíklad pokud hráè otevøe nad stolem menu a vybere ikonu lupy, v objektu stùl 
je vyvolána událost &quot;LookAt&quot; (podívat se na) a je spuštìn patøiènı blok kódu. 
Existují dva druhy událostí. Jednak jsou to vysokoúrovòové, jako &quot;LookAt&quot; 
(podívat se na) nebo &quot;Talk&quot; (promluvit na), které jsou plnì v reii vıvojáøe. 
Mùe definovat události s jakımkoliv jménem. Druhou skupinou jsou nízkoúrovòové 
události, jako napøíklad &quot;LeftClick&quot; (levé kliknutí). Tyto nízkoúrovòové 
události vyvolává sám herní engine a jejich jména jsou pevnì daná a 
dokumentovaná v této pøíruèce.</p>
<p>Podívejme se na obsluhu události &quot;LookAt&quot; (podívat se na):</p>
<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber2">
  <tr>
    <td class="code">
<pre>  GoToObject();
  actor.Talk("Blah");</pre>    
    </td>
  </tr>
</table>
<p>

<p>Tento kousek kódu øíká hernímu engine, e má zavolat funkci &quot;GoToObject&quot; (jdi 
k objektu) a poté má postava øíct &quot;Blah&quot; (actor = postava, Talk = mluvit). 
Funkce GoToObject byla pro vaše pohodlí u pøedgenerována a vypadá takto:</p>
<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber3">
  <tr>
    <td class="code">
<pre>function GoToObject()
{
  actor.GoTo(200, 200);
  actor.TurnTo(DI_UP);
}</pre>
    </td>
  </tr>
</table>
<p>


<p>Tato funkce vykonává následující: postava dojde na pozici 200, 200 ve scénì a 
otoèí se nahoru (GoTo = jdi na, TurnTo = otoèit se, Up = nahoru).</p>
<p>Modifikujeme tento skript, abychom dosáhli následujícího: Kdy hráè pouije 
ikonu lupy na stùl (a tedy v nìm vyvolá událost &quot;LookAt&quot;), postava dojde ke 
stolu, otoèí se k nìmu a øekne &quot;Je to tìkı dubovı stùl.&quot;</p>
<p>Poslední èást zvládneme snadno, prostì pøepíšeme øetìzec &quot;Blah&quot;. Obsluha 
události &quot;LookAt&quot; teï vypadá takto:</p>
<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber4">
  <tr>
    <td class="code">
<pre>on "LookAt"
{
  GoToObject();
  actor.Talk("Je to tìkı dubovı stùl.");
}
</pre>
</td>
  </tr>
</table>
<p>


<p>Teï musíme zmìnit funkci GoToObject tak, aby postava došla na správnou pozici 
ve scénì. Ale jak zjistíme správnou pozici? Mno, nejjednodušší je opìt pouít 
nástroj pro umístìní postavy (je popsán v
<a href="inside_scenes_step6.html#actor_placement">kroku 6</a> této vıuky). 
Vrate se zpátky do SceneEditu a zavøete okno se skripty (kliknìte Ok). 
Stisknìte tlaèítko &quot;Place actor&quot; (Umístit postavu) a vyberte soubor molly.actor. 
Nyní nastavte postavu do takové pozice, v jaké by mìla stát pøi prohlíení stolu 
(pamatujte: postavou pohybujete myší, pravım tlaèítkem mìníte její natoèení a 
levım tlaèítkem ji umístíte na trvalo).</p>


<p align="center">
<img border="0" src="../img/tut7-12.gif" width="410" height="512"></p>


<p align="center">&nbsp;</p>


<p>Dobøe, teï máme postavu na správném místì, ale jak tu pozici dostaneme do 
skriptu? Pouijte v menu funkci &quot;Actor-&gt;Copy actor placement&quot; 
(Postava-&gt;Kopírovat umístìní postavy) a nebo prostì stisknìte obvyklou 
klávesovou kombinaci Ctrl+C.</p>


<p align="center">
<img border="0" src="../img/tut7-13.gif" width="354" height="154"></p>


<p align="center">&nbsp;</p>


<p>Do schránky systému Windows bude zkopírován následující fragment kódu:</p>
<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber5">
  <tr>
    <td class="code">
<pre>actor.GoTo(544, 638);
actor.TurnTo(DI_UPRIGHT);</pre>
</td>
  </tr>
</table>
<p>


<p>


<p>Tento kód pøedstavuje umístìní postavy, které jsme právì nastavili ve 
SceneEditu. Jediné co teï musíme udìlat je vloit tento kód do funkce GoToObject 
v našem &quot;skriptu desk.script&quot;. Funkce pak bude vypadat takto:</p>


<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber6">
  <tr>
    <td class="code">
<pre>function GoToObject()
{
  actor.GoTo(544, 638);
  actor.TurnTo(DI_UPRIGHT);
}
</pre>
    </td>
  </tr>
</table>


<p>Také mùete zmìnit obsluhu události &quot;Take&quot; (vzít). Postava by mohla prohlásit 
nìco rádoby vtipného, kdy se hráè pokusí sebrat stùl.</p>



<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber7">
  <tr>
    <td class="code">
<pre>on "Take"
{
  GoToObject();
  actor.Talk("Ten stùl je pro mou malièkost trochu moc tìkı...");
}
</pre>
    
    </td>
  </tr>
</table>



<p>Jeliko se stolem se nedá mluvit, mùete obsluhu události &quot;Talk&quot; úplnì 
vymazat. Kdy není ádná speciální obsluha nalezena, pouije se základní.</p>

<p>Obsluha události &quot;LeftClick&quot; jednoduše zavolá funkci GoToObject. To znamená, 
e pokud hráè klikne na stùl, postava k nìmu dojde.</p>

<p>Tímto je náš jednoduchı skript hotov. Ulote jej, ulote scénu, ukonèete 
SceneEdit a pøepnìte se zpìt do ProjectManu.</p>

<p>Spuste hru a otestujte scénu. Kliknìte pravım tlaèítkem na stùl a objeví se 
menu. Zkoušejte rùzné ikony. Postava by mìla dojít ke stolu, otoèit se k nìmu a 
øíct patøiènou vìtu.</p>


<p align="center">
<img border="0" src="../img/tut7-14.gif" width="417" height="414"></p>


<p align="center">&nbsp;</p>


<p>Ostatním objektùm ve scénì lze pøiøazovat skripty úplnì stejnım zpùsobem. Pro 
inspiraci se mùete podívat na skripty v dokonèené scénì &quot;step7.scene&quot;.</p>

<p>Fajn, dost programování. Teï se pøesuneme k dalšímu kroku této vıuky,
<a href="inside_scenes_step8.html">Krok 8: Vrstvy scény</a>.</p>

</body>

</html>